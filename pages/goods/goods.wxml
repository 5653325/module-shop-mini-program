<view class="container">
  <swiper class="goodsimgs" indicator-dots="true" autoplay="true" interval="3000" duration="1000">
    <swiper-item wx:for="{{product.productImages}}" wx:key="{{item.id}}">
      <image src="{{item.mediaUrl}}" background-size="cover"></image>
    </swiper-item>
  </swiper>
  <view class="service-policy">
    <view class="item">30天无忧退货</view>
    <view class="item">48小时快速退款</view>
    <view class="item">满88元免邮费</view>
  </view>
  <view class="goods-info">
    <view class="c">
      <text class="name">{{product.name}}</text>
      <text class="desc">{{product.shortDescription}}</text>
      <text class="price">￥{{product.price}}</text>
      <view class="brand" wx:if="{{product.brandName}}">
        <navigator url="../brandDetail/brandDetail?id={{product.brandId}}">
          <text>{{product.brandName}}</text>
        </navigator>
      </view>
    </view>
  </view>
  <view class="section-nav section-attr" bindtap="switchAttrPop">
    <view class="t">请选择规格数量</view>
    <image class="i" src="../../static/images/address_right.png" background-size="cover"></image>
  </view>
  <!-- <view class="section-nav section-act">
      <view class="t">
        <view class="label">1个促销:</view>
        <view class="tag">万圣趴</view>
        <view class="text">全场满499，额外送糖果</view>
      </view>
      <image class="i" src="../../static/images/address_right.png" background-size="cover"></image>
    </view> -->
  <view class="comments" wx:if="{{reviewsInfo.reviewsCount > 0}}">
    <view class="h">
      <navigator url="../comment/comment?entityId={{product.id}}&entityTypeId=3">
        <text class="t">评价({{reviewsInfo.reviewsCount>999?'999+':reviewsInfo.reviewsCount}})</text>
        <view class="i">
          好评度
          <text class="text-red text-xl">{{reviewsInfo.positiveRatingPercent}}%</text>
        </view>
      </navigator>
    </view>
    <view class="b">
      <view class="cu-capsule radius margin-top-sm">
        <view class="cu-tag bg-cyan">
          <text class="text-white">评分</text>
        </view>
        <view class="cu-tag line-cyan">
          <text class="text-cyan text-xl">{{reviewsInfo.ratingAverage}}</text>
          /5
        </view>
      </view>
      <view class="item">
        <view class="info">
          <!-- <view class="user">
            <image src="{{comment.data.avatar}}"></image>
            <text>{{comment.data.nickname}}</text>
          </view> -->
          <!-- <view class="time">{{comment.data.add_time}}</view> -->
        </view>
        <!-- <view class="content">{{comment.data.content}}</view> -->
        <!-- <view class="imgs" wx:if="{{comment.data.pic_list.length > 0}}">
          <image class="img" wx:for="{{comment.data.pic_list}}" wx:key="{{item.id}}" src="{{item.pic_url}}"></image>
        </view> -->
        <!-- <view class="spec">白色 2件</view> -->
      </view>
    </view>
  </view>
  <view class="goods-attr">
    <view class="t">商品参数</view>
    <view class="l">
      <view class="item" wx:for="{{product.attributes}}" wx:key="{{item.key}}">
        <text class="left">{{item.key}}</text>
        <text class="right">{{item.value}}</text>
      </view>
    </view>
  </view>
  <view class="detail">
    <import src="../../lib/wxParse/wxParse.wxml" />
    <template is="wxParse" data="{{wxParseData:specification.nodes}}" />
  </view>
  <view class="detail">
    <import src="../../lib/wxParse/wxParse.wxml" />
    <template is="wxParse" data="{{wxParseData:description.nodes}}" />
  </view>
  <view class="common-problem">
    <view class="h">
      <view class="line"></view>
      <text class="title">常见问题</text>
    </view>
    <view class="b">
      <view class="item" wx:for="{{product.issues}}" wx:key="{{item.id}}">
        <view class="question-box">
          <text class="spot"></text>
          <text class="question">{{item.question}}</text>
        </view>
        <view class="answer">{{item.answer}}</view>
      </view>
    </view>
  </view>
  <view class="related-goods" wx:if="{{relateds.length > 0}}">
    <view class="h">
      <view class="line"></view>
      <text class="title">大家都在看</text>
    </view>
    <view class="b">
      <view class="item" wx:for="{{relateds}}" wx:key="{{item.id}}">
        <navigator url="/pages/goods/goods?id={{item.id}}">
          <image class="img" src="{{item.thumbnailUrl}}" background-size="cover"></image>
          <text class="name">{{item.name}}</text>
          <text class="price">￥{{item.price}}</text>
        </navigator>
      </view>
    </view>
  </view>
</view>
<view class="attr-pop-box" hidden="{{!openAttr}}">
  <view class="attr-pop">
    <view class="close" bindtap="closeAttr">
      <image class="icon" src="/static/images/icon_close.png"></image>
    </view>
    <view class="img-info">
      <image class="img" src="{{currentSkuImageUrl}}"></image>
      <view class="info">
        <view class="c">
          <view class="p">价格：￥{{product.price}}</view>
          <view wx:if="{{isAllSpec}}">
            <view class="a" style="color:red;" wx:if="{{!currentStock.isAllowToOrder}}">无货</view>
            <view class="a" style="" wx:elif="{{currentStock.isAllowToOrder && currentStock.displayStockAvailability && currentStock.displayStockQuantity}}">
              库存：{{currentStock.stockQuantity}}
            </view>
            <view class="a" style="" wx:elif="{{currentStock.isAllowToOrder && currentStock.displayStockAvailability}}">有货</view>
          </view>
          <view class="a" wx:if="{{product.options.length>0}}">{{checkedSpecText}}</view>
        </view>
      </view>
    </view>
    <view class="spec-con">
      <view class="spec-item" wx:for="{{product.options}}" wx:key="{{item.id}}">
        <view class="name">{{item.name}}</view>
        <view class="values">
          <view class="value {{vitem.checked ? 'selected' : ''}}" bindtap="clickSkuValue" wx:for="{{item.values}}" wx:for-item="vitem" wx:key="{{vitem.id}}" data-value-id="{{vitem.id}}" data-name-id="{{item.id}}">
            {{vitem.value}}
          </view>
        </view>
      </view>
      <view class="number-item">
        <view class="name">数量</view>
        <view class="selnum">
          <view class="cut" bindtap="cutNumber">-</view>
          <input value="{{number}}" class="number" disabled="true" type="number" />
          <view class="add" bindtap="addNumber">+</view>
        </view>
      </view>
    </view>
  </view>
</view>
<view class="bottom-btn">
  <view class="l l-collect" bindtap="switchCollect">
    <image class="icon" src="{{ collectBackImage }}"></image>
  </view>
  <view class="l l-cart">
    <view class="box">
      <text class="cart-count">{{cartGoodsCount}}</text>
      <image bindtap="openCartPage" class="icon" src="/static/images/ic_menu_shoping_nor.png"></image>
    </view>
  </view>
  <view class="c">立即购买</view>
  <view class="r" bindtap="addToCart">加入购物车</view>
</view>